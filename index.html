<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2563eb">
  <meta name="description" content="Generate engaging tweets based on current affairs with AI">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TweetGen">
  
  <title>Tweet Generator - Current Affairs</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --secondary: #8b5cf6;
      --background: #fafbfc;
      --surface: #ffffff;
      --text: #1a202c;
      --text-secondary: #64748b;
      --border: #e2e8f0;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    body {
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #root {
      min-height: 100vh;
      padding-bottom: env(safe-area-inset-bottom);
    }

    .loader-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: white;
      font-size: 18px;
      font-weight: 500;
      gap: 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    /* Mobile-specific optimizations */
    @media (max-width: 768px) {
      body {
        font-size: 16px;
      }
      
      input, button, textarea {
        font-size: 16px !important;
      }
    }

    body {
      overscroll-behavior-y: contain;
    }

    /* SVG Icons as inline definitions */
    .icon {
      width: 20px;
      height: 20px;
      display: inline-block;
      vertical-align: middle;
    }

    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--surface);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      animation: slideUp 0.3s ease-out;
      max-width: calc(100% - 40px);
    }

    .install-prompt button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .install-prompt .close-btn {
      background: transparent;
      color: var(--text-secondary);
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="loader-container">
      <div class="spinner"></div>
      <div>Loading Tweet Generator...</div>
    </div>
  </div>

  <!-- Load React from CDN with fallback -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    // Check if React loaded
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
      document.getElementById('root').innerHTML = `
        <div class="loader-container">
          <div style="text-align: center; max-width: 400px; padding: 20px;">
            <h2 style="color: white; margin-bottom: 10px;">‚ö†Ô∏è Loading Error</h2>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 20px;">
              Unable to load required libraries. Please check your internet connection and refresh the page.
            </p>
            <button onclick="location.reload()" style="
              background: white;
              color: #667eea;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              font-weight: 600;
              cursor: pointer;
              font-size: 16px;
            ">Refresh Page</button>
          </div>
        </div>
      `;
    }
  </script>

  <script type="text/javascript">
    (function() {
      const { useState, useEffect, useRef, createElement: h } = React;

      // Simple icon components
      const Icon = ({ type, size = 20, color = 'currentColor', className = '', style = {} }) => {
        const icons = {
          sparkles: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z',
          search: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z',
          copy: 'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z',
          refresh: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15',
          loader: 'M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z',
          trending: 'M13 7h8m0 0v8m0-8l-8 8-4-4-6 6',
          download: 'M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4',
          x: 'M6 18L18 6M6 6l12 12'
        };
        
        return h('svg', {
          width: size,
          height: size,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: color,
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round',
          className: className,
          style: style
        }, h('path', { d: icons[type] || '' }));
      };

      function TweetGeneratorApp() {
        const [topic, setTopic] = useState('');
        const [tone, setTone] = useState('casual');
        const [tweets, setTweets] = useState([]);
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');
        const [copiedIndex, setCopiedIndex] = useState(null);
        const [showInstallPrompt, setShowInstallPrompt] = useState(false);
        const deferredPrompt = useRef(null);

        const tones = [
          { value: 'casual', label: 'Casual', desc: 'Friendly vibe', emoji: 'üòä' },
          { value: 'professional', label: 'Pro', desc: 'Polished', emoji: 'üíº' },
          { value: 'humorous', label: 'Funny', desc: 'Witty', emoji: 'üòÑ' },
          { value: 'hot-take', label: 'Hot Take', desc: 'Bold', emoji: 'üî•' },
          { value: 'informative', label: 'Info', desc: 'Educational', emoji: 'üìö' }
        ];

        useEffect(() => {
          const handleBeforeInstallPrompt = (e) => {
            e.preventDefault();
            deferredPrompt.current = e;
            setShowInstallPrompt(true);
          };

          window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
              .then(reg => console.log('Service Worker registered'))
              .catch(err => console.log('Service Worker registration failed', err));
          }

          return () => {
            window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
          };
        }, []);

        const handleInstallClick = async () => {
          if (deferredPrompt.current) {
            deferredPrompt.current.prompt();
            const { outcome } = await deferredPrompt.current.userChoice;
            deferredPrompt.current = null;
            setShowInstallPrompt(false);
          }
        };

        const generateTweets = async () => {
          if (!topic.trim()) {
            setError('Please enter a topic');
            return;
          }

          setLoading(true);
          setError('');
          setTweets([]);

          try {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 1000,
                messages: [
                  {
                    role: 'user',
                    content: `Search for the latest news and current affairs about: ${topic}

Then generate 4 different tweet options about this topic in a ${tone} tone. Each tweet must be under 280 characters.

Return ONLY a JSON array with this exact format, no other text:
[
  {"tweet": "tweet text here", "hashtags": ["tag1", "tag2"]},
  {"tweet": "tweet text here", "hashtags": ["tag1", "tag2"]},
  {"tweet": "tweet text here", "hashtags": ["tag1", "tag2"]},
  {"tweet": "tweet text here", "hashtags": ["tag1", "tag2"]}
]`
                  }
                ],
                tools: [
                  {
                    type: 'web_search_20250305',
                    name: 'web_search'
                  }
                ]
              })
            });

            const data = await response.json();
            
            let fullText = '';
            if (data.content) {
              for (const block of data.content) {
                if (block.type === 'text') {
                  fullText += block.text;
                }
              }
            }

            const cleanText = fullText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
            const parsedTweets = JSON.parse(cleanText);
            
            setTweets(parsedTweets);
          } catch (err) {
            setError('Failed to generate tweets. Please try again.');
            console.error(err);
          } finally {
            setLoading(false);
          }
        };

        const copyTweet = (text, index) => {
          navigator.clipboard.writeText(text);
          setCopiedIndex(index);
          setTimeout(() => setCopiedIndex(null), 2000);

          if (navigator.vibrate) {
            navigator.vibrate(50);
          }
        };

        const getCharCount = (text) => text.length;

        return h('div', {
          style: {
            minHeight: '100vh',
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            padding: '20px 16px',
            paddingBottom: '40px'
          }
        }, 
          h('div', { style: { maxWidth: '600px', margin: '0 auto' } },
            // Header
            h('div', {
              style: {
                textAlign: 'center',
                marginBottom: '28px',
                animation: 'fadeIn 0.6s ease-out'
              }
            },
              h('div', {
                style: {
                  display: 'inline-flex',
                  alignItems: 'center',
                  gap: '12px',
                  background: 'rgba(255, 255, 255, 0.15)',
                  backdropFilter: 'blur(10px)',
                  padding: '12px 24px',
                  borderRadius: '20px',
                  marginBottom: '12px',
                  border: '1px solid rgba(255, 255, 255, 0.2)'
                }
              },
                h(Icon, { type: 'sparkles', size: 28, color: '#fff' }),
                h('h1', {
                  style: {
                    fontSize: '32px',
                    fontWeight: '800',
                    color: '#fff',
                    margin: 0,
                    fontFamily: "'Outfit', sans-serif"
                  }
                }, 'TweetGen')
              ),
              h('p', {
                style: {
                  color: 'rgba(255, 255, 255, 0.9)',
                  fontSize: '15px',
                  fontWeight: '500'
                }
              }, 'AI-powered tweets from current affairs')
            ),

            // Input Card
            h('div', {
              style: {
                background: 'var(--surface)',
                borderRadius: '24px',
                boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                padding: '24px',
                marginBottom: '20px',
                animation: 'fadeIn 0.6s ease-out 0.1s backwards'
              }
            },
              h('div', { style: { marginBottom: '20px' } },
                h('label', {
                  style: {
                    display: 'block',
                    fontSize: '14px',
                    fontWeight: '600',
                    color: 'var(--text)',
                    marginBottom: '8px'
                  }
                }, 'What\'s trending?'),
                h('div', { style: { position: 'relative' } },
                  h(Icon, {
                    type: 'trending',
                    size: 20,
                    color: 'var(--text-secondary)',
                    style: {
                      position: 'absolute',
                      left: '14px',
                      top: '50%',
                      transform: 'translateY(-50%)'
                    }
                  }),
                  h('input', {
                    type: 'text',
                    value: topic,
                    onChange: (e) => setTopic(e.target.value),
                    onKeyPress: (e) => e.key === 'Enter' && generateTweets(),
                    placeholder: 'AI news, climate summit, tech earnings...',
                    style: {
                      width: '100%',
                      paddingLeft: '46px',
                      paddingRight: '16px',
                      paddingTop: '14px',
                      paddingBottom: '14px',
                      border: '2px solid var(--border)',
                      borderRadius: '14px',
                      fontSize: '16px',
                      fontFamily: "'Outfit', sans-serif",
                      fontWeight: '500',
                      transition: 'all 0.2s',
                      outline: 'none'
                    }
                  })
                )
              ),

              h('div', { style: { marginBottom: '20px' } },
                h('label', {
                  style: {
                    display: 'block',
                    fontSize: '14px',
                    fontWeight: '600',
                    color: 'var(--text)',
                    marginBottom: '10px'
                  }
                }, 'Tone'),
                h('div', {
                  style: {
                    display: 'grid',
                    gridTemplateColumns: 'repeat(auto-fit, minmax(100px, 1fr))',
                    gap: '8px'
                  }
                },
                  tones.map((t) =>
                    h('button', {
                      key: t.value,
                      onClick: () => setTone(t.value),
                      style: {
                        padding: '12px 8px',
                        borderRadius: '12px',
                        border: tone === t.value ? '2px solid var(--primary)' : '2px solid var(--border)',
                        background: tone === t.value ? 'rgba(37, 99, 235, 0.08)' : 'transparent',
                        cursor: 'pointer',
                        transition: 'all 0.2s',
                        fontFamily: "'Outfit', sans-serif"
                      }
                    },
                      h('div', { style: { fontSize: '20px', marginBottom: '4px' } }, t.emoji),
                      h('div', {
                        style: {
                          fontSize: '13px',
                          fontWeight: '600',
                          color: tone === t.value ? 'var(--primary)' : 'var(--text)'
                        }
                      }, t.label),
                      h('div', {
                        style: {
                          fontSize: '11px',
                          color: 'var(--text-secondary)',
                          marginTop: '2px'
                        }
                      }, t.desc)
                    )
                  )
                )
              ),

              h('button', {
                onClick: generateTweets,
                disabled: loading,
                style: {
                  width: '100%',
                  background: loading ? 'var(--text-secondary)' : 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)',
                  color: 'white',
                  fontWeight: '700',
                  fontSize: '16px',
                  padding: '16px',
                  borderRadius: '14px',
                  border: 'none',
                  cursor: loading ? 'not-allowed' : 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px',
                  transition: 'all 0.2s',
                  boxShadow: loading ? 'none' : '0 4px 12px rgba(37, 99, 235, 0.3)',
                  fontFamily: "'Outfit', sans-serif"
                }
              },
                loading
                  ? [
                      h(Icon, {
                        type: 'loader',
                        size: 20,
                        style: { animation: 'spin 1s linear infinite' }
                      }),
                      'Generating...'
                    ]
                  : [
                      h(Icon, { type: 'sparkles', size: 20 }),
                      'Generate Tweets'
                    ]
              ),

              error && h('div', {
                style: {
                  marginTop: '16px',
                  padding: '12px 16px',
                  background: 'rgba(239, 68, 68, 0.1)',
                  border: '1px solid rgba(239, 68, 68, 0.3)',
                  borderRadius: '12px',
                  color: 'var(--error)',
                  fontSize: '14px',
                  fontWeight: '500'
                }
              }, error)
            ),

            // Results
            tweets.length > 0 && h('div', { style: { animation: 'fadeIn 0.6s ease-out' } },
              h('h2', {
                style: {
                  fontSize: '22px',
                  fontWeight: '800',
                  color: '#fff',
                  marginBottom: '16px',
                  fontFamily: "'Outfit', sans-serif"
                }
              }, 'Your Tweets'),

              tweets.map((item, index) => {
                const fullTweet = `${item.tweet} ${item.hashtags.map(tag => `#${tag}`).join(' ')}`;
                const charCount = getCharCount(fullTweet);
                const isOverLimit = charCount > 280;

                return h('div', {
                  key: index,
                  style: {
                    background: 'var(--surface)',
                    borderRadius: '20px',
                    padding: '20px',
                    marginBottom: '12px',
                    boxShadow: 'var(--shadow-lg)',
                    animation: `fadeIn 0.4s ease-out ${index * 0.1}s backwards`
                  }
                },
                  h('div', {
                    style: {
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      marginBottom: '12px'
                    }
                  },
                    h('span', {
                      style: {
                        fontSize: '13px',
                        fontWeight: '700',
                        color: 'var(--primary)',
                        textTransform: 'uppercase',
                        letterSpacing: '0.5px'
                      }
                    }, `Option ${index + 1}`),
                    h('div', { style: { display: 'flex', alignItems: 'center', gap: '12px' } },
                      h('span', {
                        style: {
                          fontSize: '13px',
                          fontWeight: '600',
                          color: isOverLimit ? 'var(--error)' : 'var(--text-secondary)'
                        }
                      }, `${charCount}/280`),
                      h('button', {
                        onClick: () => copyTweet(fullTweet, index),
                        style: {
                          padding: '8px',
                          background: copiedIndex === index ? 'rgba(16, 185, 129, 0.1)' : 'transparent',
                          border: 'none',
                          borderRadius: '10px',
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '4px'
                        }
                      },
                        copiedIndex === index
                          ? h('span', {
                              style: {
                                color: 'var(--success)',
                                fontSize: '13px',
                                fontWeight: '600'
                              }
                            }, '‚úì Copied')
                          : h(Icon, { type: 'copy', size: 18, color: 'var(--text-secondary)' })
                      )
                    )
                  ),

                  h('p', {
                    style: {
                      color: 'var(--text)',
                      fontSize: '16px',
                      lineHeight: '1.6',
                      marginBottom: '12px',
                      fontWeight: '500',
                      whiteSpace: 'pre-wrap'
                    }
                  }, item.tweet),

                  item.hashtags.length > 0 && h('div', {
                    style: {
                      display: 'flex',
                      flexWrap: 'wrap',
                      gap: '6px'
                    }
                  },
                    item.hashtags.map((tag, tagIndex) =>
                      h('span', {
                        key: tagIndex,
                        style: {
                          padding: '6px 12px',
                          background: 'linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%)',
                          color: 'var(--primary)',
                          borderRadius: '8px',
                          fontSize: '13px',
                          fontWeight: '600'
                        }
                      }, `#${tag}`)
                    )
                  ),

                  isOverLimit && h('div', {
                    style: {
                      marginTop: '12px',
                      padding: '10px 12px',
                      background: 'rgba(239, 68, 68, 0.1)',
                      border: '1px solid rgba(239, 68, 68, 0.3)',
                      borderRadius: '10px',
                      fontSize: '13px',
                      color: 'var(--error)',
                      fontWeight: '500'
                    }
                  }, '‚ö†Ô∏è Exceeds character limit')
                );
              }),

              h('button', {
                onClick: generateTweets,
                disabled: loading,
                style: {
                  width: '100%',
                  background: 'rgba(255, 255, 255, 0.15)',
                  backdropFilter: 'blur(10px)',
                  color: 'white',
                  fontWeight: '700',
                  fontSize: '16px',
                  padding: '16px',
                  borderRadius: '14px',
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '8px',
                  marginTop: '12px',
                  fontFamily: "'Outfit', sans-serif"
                }
              },
                h(Icon, { type: 'refresh', size: 20 }),
                'Generate New'
              )
            ),

            // Install Prompt
            showInstallPrompt && h('div', {
              className: 'install-prompt'
            },
              h(Icon, { type: 'download', size: 20, color: 'var(--primary)' }),
              h('span', { style: { fontSize: '14px', fontWeight: '500' } }, 'Install app for quick access'),
              h('button', { onClick: handleInstallClick }, 'Install'),
              h('button', {
                className: 'close-btn',
                onClick: () => setShowInstallPrompt(false)
              }, h(Icon, { type: 'x', size: 18 }))
            )
          )
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(h(TweetGeneratorApp));
    })();
  </script>
</body>
</html>
